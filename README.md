### Contract address

- [remote config](./scripts/config/remote_config.json)
  Xml-rpc: http://18.166.30.91:8545/
- ChainId: 31337


- [dev config](./scripts/config/dev_config.json)
  Xml-rpc: http://43.198.67.105:8545/
- ChainId: 31337

### Test account

- Dev Private chain.

```text
Account #0 (admin / keeper): 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266 (10000 ETH)
Private Key: 0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80

Account #1 (operator / treasurer): 0x70997970C51812dc3A010C7d01b50e0d17dc79C8 (10000 ETH)
Private Key: 0x59c6995e998f97a5a0044966f0945389dc9e86dae88c7a8412f4603b6b78690d

Account #2: (community) 0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC (10000 ETH)
Private Key: 0x5de4111afa1a4b94908f83103eb1f1706367c2e68ca870fc3fb9a804cdab365a

Account #3: 0x90F79bf6EB2c4f870365E785982E1f101E93b906 (10000 ETH)
Private Key: 0x7c852118294e51e653712a81e05800f419141751be58f605c371e15141b007a6

Account #4: 0x15d34AAf54267DB7D7c367839AAf71A00a2C6A65 (10000 ETH)
Private Key: 0x47e179ec197488593b187f80a00eb0da91f1b9d0b13f8733639f19c30a34926a

Account #5: 0x9965507D1a55bcC2695C58ba16FB37d819B0A4dc (10000 ETH)
Private Key: 0x8b3a350cf5c34c9194ca85829a2df0ec3153be0318b5e2d3348e872092edffba

Account #6: 0x976EA74026E726554dB657fA54763abd0C3a0aa9 (10000 ETH)
Private Key: 0x92db14e403b83dfe3df233f83dfa3a0d7096f21ca9b0d6d6b8d88b2b4ec1564e

Account #7: 0x14dC79964da2C08b23698B3D3cc7Ca32193d9955 (10000 ETH)
Private Key: 0x4bbbf85ce3377467afe5d46f804f221813b2bb87f24d81f60f1fcdbf7cbf4356

Account #8: 0x23618e81E3f5cdF7f54C3d65f7FBc0aBf5B21E8f (10000 ETH)
Private Key: 0xdbda1821b80551c9d65939329250298aa3472ba22feea921c0cf5d620ea67b97

Account #9: 0xa0Ee7A142d267C1f36714E4a8F75612F20a79720 (10000 ETH)
Private Key: 0x2a871d0798f97d79848a013d4936a73bf4cc922c825d33c1cf7073dff6d409c6

Account #10: 0xBcd4042DE499D14e55001CcbB24a551F3b954096 (10000 ETH)
Private Key: 0xf214f2b2cd398c806f84e317254e0f0b801d0643303237d97a22a48e01628897

Account #11: 0x71bE63f3384f5fb98995898A86B02Fb2426c5788 (10000 ETH)
Private Key: 0x701b615bbdfb9de65240bc28bd21bbc0d996645a3dd57e7b12bc2bdf6f192c82

Account #12: 0xFABB0ac9d68B0B445fB7357272Ff202C5651694a (10000 ETH)
Private Key: 0xa267530f49f8280200edf313ee7af6b827f2a8bce2897751d06a843f644967b1

Account #13: 0x1CBd3b2770909D4e10f157cABC84C7264073C9Ec (10000 ETH)
Private Key: 0x47c99abed3324a2707c28affff1267e45918ec8c3f20b8aa892e8b065d2942dd

Account #14: 0xdF3e18d64BC6A983f673Ab319CCaE4f1a57C7097 (10000 ETH)
Private Key: 0xc526ee95bf44d8fc405a158bb884d9d1238d99f0612e9f33d006bb0789009aaa

Account #15: 0xcd3B766CCDd6AE721141F452C550Ca635964ce71 (10000 ETH)
Private Key: 0x8166f546bab6da521a8369cab06c5d2b9e46670292d85c875ee9ec20e84ffb61

Account #16: 0x2546BcD3c84621e976D8185a91A922aE77ECEc30 (10000 ETH)
Private Key: 0xea6c44ac03bff858b476bba40716402b03e41b8e97e276d1baec7c37d42484a0

Account #17: 0xbDA5747bFD65F08deb54cb465eB87D40e51B197E (10000 ETH)
Private Key: 0x689af8efa8c651a91ad287602527f3af2fe9f6501a7ac4b061667b5a93e037fd

Account #18: 0xdD2FD4581271e230360230F9337D5c0430Bf44C0 (10000 ETH)
Private Key: 0xde9be858da4a475276426320d5e9262ecfc3ba460bfac56360bfa6c4c28b4ee0

Account #19: 0x8626f6940E2eb28930eFb4CeF49B2d1F2C9C1199 (10000 ETH)
Private Key: 0xdf57089febbacf7ba0bc227dafbffa9fc08a93fdc68e1e42411a14efcf23656e

```

- goerli

```text
Account #0 (admin): 0x9a51ed860dfd64ac1faf6f2df906c31b588d1f26
Private Key: 0x35fb41f603c91d8fdf29391ce17e96d50f028dd895762027806cde096dca8a3b

Sign the Account # 1 (1) : 0 x229b2dd414fc6d64d49f252d6efd960bb80c49ad
Private Key: 0x56e7a541829f9e675773c9e2542fe31c6cd8c742f156c1b5beafe3f4f483eea2

Sign the Account # 2 (2) : 0 x1a5240e6427c8fb400770b6260385cd18b89ed91
Private Key: 0xe9733eeed09ad95c2ef876eb7c9073a68a49651101f93dfdc56bea3b16baabcd

Sign the Account # 3 (3) : 0 xf28c074e6d49332f89ba69faa7438e5038f9e2b2
Private Key: 0x2f218d6f236015060f30827825d5d24711d01d502d0a5bd3ec85043ff45c2ae2

Account #4 (user1): 0xC177e2A539Be587792808D94d3Ca076c6317227c
Private Key: 0xa661ddc2b2524edf18074ac62ed919c8af1fedcd658d5361e0ed7eee249ff168

Sign a contract, 0 xe72adf5f08db431258776205172d2f1ff1cc4541
```

### Contract interface

#### event code

```text
contract: PairLiquidity
event: AddLiquidity id: ae2a8a26a2b64d8d971277b87c24d1a12181aef23cf76b898a32ce8dd14c7591
event: RemoveLiquidity id: 6291bcce50c38c39d79a98ff5fad7f35319722e73285b50a6140dbfac75d511e
event: Swap id: 2424e4440d8e90b9be053a61916674e21e7603a28f7dccf3ff7b88b755c2e619

contract: OrderManager
event: CancelDecreaseOrder id: b225fd6bcccad9342bc10ccc7e25ef77175b77348c8393d669ac2dbc98a1ae29
event: CancelIncreaseOrder id: 7e93a6b00cb3caacf000d7018943b12e2b4ad29e7849df14ebd51caf4fd739b8
event: CreateDecreaseOrder id: e71a68544c2c9cf2a006d283baa849468003198fa8d8026335170198a30349dd
event: CreateIncreaseOrder id: e83629b11df9fcc6b9ebc666eb284c939d1710576a8d3eac23474d70fae8d478

contract: Executor
event: ExecuteDecreaseOrder id: 9b4ff42a2fc7960edd49c603150f69894e46d386129c040ae7519a427fee0613
event: ExecuteIncreaseOrder id: 462ad18c79032b6336d456416b46e1012c8ed1c03cd3ff073957ae8834539e72
event: LiquidatePosition id: aac40228c5d58dfc6360c331165fa5a8fa13f51c87a6124cb1999a4c6117bb79

contract: PositionManager
event: ClosePosition id: 1ffb81f32d2d371994fb39b875fbe035d34386083d2a85a3cf2894709c4581a2
event: DecreasePosition id: f1d296a817e8ecfa2709fcd52c61a6dddc7e87ed697b3ba601e88dbee8849c20
event: IncreasePosition id: 07777c9f149d310fb8670fb9752de106d0ebc29093eb6df2be370406a7d742a3
event: UpdateFundingRate id: 30ee8c76a6febcb0400fb07183d873b5c18cf9e5ca6a47104676795b989c606d
event: UpdatePosition id: 9a23c22b6372bd11ffa0aced0db638ca7c144fc3996ecc8fbe3f9a639ef285ad
```

#### Set parameters

-   Pool
```solidity
// Update the trade pair configuration
updatePair(uint256 _pairIndex, Pair calldata _pair)

struct Pair {
address indexToken;      // Trade against the base currency
address stableToken;     // Trade against stablecoins
address pairToken;       // lp token
bool enable;             // Whether it is available
uint256 kOfSwap;         // Initial k value of liquidity
uint256 expectIndexTokenP;    // index Initial token ratio 5000 for 50%
uint256 addLpFeeP;       // Add liquidity fee
}

// Update the trading configuration
updateTradingConfig(uint256 _pairIndex, TradingConfig calldata _tradingConfig)

struct TradingConfig {
uint256 minLeverage;         // Minimum leverage
uint256 maxLeverage;         // Maximum leverage
uint256 minTradeAmount;      // Minimum trading volume
uint256 maxTradeAmount;      // Maximum trading volume
uint256 maxPositionAmount;   // Maximum open position
uint256 maintainMarginRate;  // Maintain the margin rate of 10000 for 100%
uint256 priceSlipP;          // Price slip point
uint256 maxPriceDeviationP;  // Maximum offset of index price
}

// Update the trading fee configuration
updateTradingFeeConfig(uint256 _pairIndex, TradingFeeConfig calldata _tradingFeeConfig)

struct TradingFeeConfig {
// fee
uint256 takerFeeP;           // taker Process rate
uint256 makerFeeP;           // maker procedure rate
// Distribute
uint256 lpDistributeP;       // lp Allocation ratio
uint256 keeperDistributeP;   // keeper Allocation ratio
uint256 treasuryDistributeP; // Treasury allocation ratio
uint256 refererDistributeP;  // Allocation ratio of invitees
}

// Update the capital fee configuration
updateFundingFeeConfig(uint256 _pairIndex, FundingFeeConfig calldata _fundingFeeConfig)


struct FundingFeeConfig {
// factor
uint256 minFundingRate;              // Minimum capital rate 1,000,000 for 100%
uint256 maxFundingRate;              // The maximum capital rate is 1,000,000 for 100%
uint256 fundingWeightFactor;         // The weight coefficient of the fund rate of both sides is 10000 for 100%
uint256 liquidityPremiumFactor;      // The coefficient of liquidity to premium is 10,000 for 100%
uint256 interest;
// Distribute
uint256 lpDistributeP;               // lp Allocation ratio
uint256 userDistributeP;             // User allocation ratio
uint256 treasuryDistributeP;         // Treasury allocation ratio
}
```

#### Open a position

-   Router

```solidity
// Create open request (front-end user)
createIncreaseOrder(IncreasePositionRequest memory request)

// Cancel order (Front-end user)
cancelIncreaseOrder(uint256 _orderId, TradeType _tradeType)

struct IncreasePositionRequest {
address account;                // Current user
uint256 pairIndex;              // Currency pair index
TradeType tradeType;            // 0: MARKET, 1: LIMIT
int256 collateral;              // 1e18 Margin amount, a negative number indicates a reduction
uint256 openPrice;              // 1e30 Market acceptable price/Limit opening price
bool isLong;                    // Long/short
uint256 sizeAmount;             // Number of positions
uint256 tpPrice;                // Stop profit price 1e30
uint256 tp;                     // The number of profit stops
uint256 slPrice;                // Stop price 1e30
uint256 sl;                     // Stop loss quantity
}

```

- Executor
```solidity
// Current market opening request not executed starting index
uint256 public increaseMarketOrderStartIndex;
// The current market closing request did not execute the start index
uint256 public decreaseMarketOrderStartIndex;
` ` `

- OrderManager
```solidity
// Current market open request latest index
uint256 public increaseMarketOrdersIndex;
// Current market price closing request latest index
uint256 public decreaseMarketOrdersIndex;
// Current limit open position request latest index
uint256 public increaseLimitOrdersIndex;
// Latest index of current limit closing requests
uint256 public decreaseLimitOrdersIndex;
```

-   Executor

```solidity
// Set the price and execute the market order
setPricesAndExecuteMarketOrders(
address[] memory _tokens,
uint256[] memory _prices,
uint256 _timestamp,
uint256 _increaseEndIndex,
uint256 _decreaseEndIndex
)

// Set the price and execute the limit order
setPricesAndExecuteLimitOrders(
address[] memory _tokens,
uint256[] memory _prices,
uint256 _timestamp,
uint256[] memory _increaseOrderIds,
uint256[] memory _decreaseOrderIds
)

// Batch market open positions (keeper: Account 0 / Account 1), endIndex: end index
executeIncreaseMarketOrders(uint256 _endIndex)

// Execute limit open positions in batches
executeIncreaseLimitOrders(uint256[] memory _orderIds)

// Execute limit open position (keeper)
executeIncr
#### stock reduction

-   Router

```solidity
// Create inventory reduction request (front-end user)
createIncreaseOrder(IncreasePositionRequest memory request)

// Request body
struct DecreasePositionRequest {
address account;                // Current user
uint256 pairIndex;
TradeType tradeType;
int256 collateral;              // 1e18 Margin amount, a negative number indicates a reduction
uint256 triggerPrice;           // Limit trigger price
uint256 sizeAmount;             // Number of customs documents
bool isLong;
}

// Cancel order (Front-end user)
cancelDecreaseOrder(uint256 _orderId, TradeType _tradeType)
```

-   Executor

```solidity

// Batch market price reduction (keeper: Account 0 / Account 1), endIndex: end index
executeDecreaseMarkets(uint256 _endIndex)

// Execute price limit reduction in batches
executeDecreaseLimitOrders(uint256[] memory _orderIds)

// Execute price limit (keeper)
executeDecreaseOrder(uint256 _orderId, TradeType tradeType)
` ` `

#### Profit and loss

-   Router

```solidity
// Create a profit stop loss separately
createTpSl(CreateTpSlRequest memory _request)

struct CreateTpSlRequest {
address account;
uint256 pairIndex;              // Currency pair index
bool isLong;
uint256 tpPrice;                // Stop profit price 1e30
uint256 tp;                     // The number of profit stops
uint256 slPrice;                // Stop price 1e30
uint256 sl;                     // Stop loss quantity
}
```

#### liquidation

-   Executor

```solidity
// Set the price and execute the liquidation
setPricesAndLiquidatePositions(
address[] memory _tokens,
uint256[] memory _prices,
uint256 _timestamp,
bytes32[] memory _positionKeys
)

// _positionKeys Array of position keys
function liquidatePositions(bytes32[] memory _positionKeys)
```

#### ADL

-   Executor

```solidity
// Set price and execute ADL
setPricesAndExecuteADL(
address[] memory _tokens,
uint256[] memory _prices,
uint256 _timestamp,
bytes32[] memory _positionKeys,
uint256[] memory _sizeAmounts,
uint256 _orderId,
ITradingRouter.TradeType _tradeType
)

// Execute ADL and stock reduction orders
executeADLAndDecreaseOrder(
bytes32[] memory _positionKeys, // ADL location key to be executed
uint256[] memory _sizeAmounts, // Number of ADL positions to be executed
uint256_orderId, // Order to be executed
ITradingRouter.TradeType _tradeType
)
```

#### handling fee

-   PositionManager

```solidity
// Get transaction fees
function getTradingFee(uint256 _pairIndex, bool _isLong, uint256 _sizeAmount)

// Get the fund rate
function getFundingFee(
bool _increase, // Add true, reduce false
address _account,
uint256 _pairIndex,
bool _isLong,
uint256_sizeAmount // Number of bits to be modified
)
```

UPDATE_SNAPSHOT=1 yarn test
